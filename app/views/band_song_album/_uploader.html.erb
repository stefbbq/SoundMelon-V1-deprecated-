<%= javascript_include_tag "swfobject.js", "jquery.uploadify.v2.1.0.js" %>
<script type="text/javascript" charset="utf-8">
  var song_counter = 1;
  <%- session_key = Rails.application.config.session_options[:key] -%> 
  $(document).ready(function() {
	   
    $('#song_song').click(function(event){ 
		    event.preventDefault();
	   }); 
	
	   $('#song_song').uploadify({
      uploader : '/uploadify/uploadify.swf',
		    cancelImg : '/uploadify/cancel.png',
		    multi : true,
		    auto : true,
  	   script : '/band_song_album/create',
		    onComplete : function(event, queueID, fileObj, response, data) { 
			     var dat = eval('(' + response + ')');
			     $('#uploaded_images').append(song_counter +">" + dat.upload+'<br />');
        $('#album_name').val(dat.album_name);
        $('#album_name').attr("disabled", true);
        song_counter++;
      },
      onSelect : function(event,data) {
        $("#song_song").uploadifySettings('scriptData', { 'album_name' : $('#album_name').val(), 'band_name' : $('#band_name').val() });
      },
  	   scriptData : {
	       '_http_accept': 'application/javascript',
					   'format' : 'json',
	       '_method': 'post',
	       '<%= session_key %>' : encodeURIComponent('<%= u cookies[session_key] %>'),
	       'authenticity_token': encodeURIComponent($('meta[name=csrf-token]').attr('content'))
	     }
	   });
	
	   $('#upload_submit').click(function(event){ 
			   event.preventDefault();
 		   $('#song_song').uploadifyUpload(); 
		  });
  }); 
</script>
